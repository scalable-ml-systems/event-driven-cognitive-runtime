Below is a production-grade repo layout that maps 1:1 to your ECR tech stack (Terraform + EKS + Strimzi Kafka + Confluent Schema Registry + Argo CD App-of-Apps + Helm + GitHub Actions + OTel/Prom/Loki/Tempo/Grafana + External Secrets + Kyverno/Gatekeeper + Buf/Protobuf + Pydantic + k6 + CodeQL).

This is the exact folder set I’d expect in a real enterprise platform repo.

ECR Repo Structure (Canonical, Production)
event-driven-cognitive-runtime/
├── README.md
├── LICENSE
├── SECURITY.md
├── CODEOWNERS
├── .gitignore

# =========================
# 1) Docs (Architecture + ADRs + Ops runbooks)
# =========================
├── docs/
│   ├── architecture/
│   │   ├── overview.md
│   │   ├── execution-flow.md
│   │   ├── context-planes.md
│   │   ├── failure-model.md
│   │   ├── security-model.md
│   │   └── sla-slo.md
│   ├── decisions/                      # ADRs (FAANG style)
│   │   ├── ADR-0001-kafka-as-sor.md
│   │   ├── ADR-0002-protobuf-contracts.md
│   │   ├── ADR-0003-argocd-gitops.md
│   │   └── ADR-0004-policy-first.md
│   ├── runbooks/
│   │   ├── incident-response.md
│   │   ├── replay-procedure.md
│   │   ├── schema-evolution.md
│   │   └── break-glass.md
│   └── diagrams/
│       ├── high-level.excalidraw.json
│       └── runtime-flow.excalidraw.json

# =========================
# 2) Contracts & Schemas (System of Record)
# - Protobuf persisted to Kafka topics via Schema Registry
# - Buf enforces breaking changes
# =========================
├── protos/
│   └── ecr/
│       └── v1/
│           ├── events/
│           │   ├── decision_event.proto
│           │   ├── step_event.proto
│           │   ├── audit_event.proto
│           │   └── dlq_event.proto
│           ├── decisions/
│           │   ├── decision_request.proto
│           │   └── decision_response.proto
│           └── common/
│               ├── identifiers.proto
│               └── tenant.proto
├── buf.yaml
├── buf.lock
├── buf.gen.yaml

# =========================
# 3) Application Services (Cognitive Runtime)
# - Pydantic v2 for HTTP + internal validation
# - Protobuf for persisted events
# =========================
├── services/
│   ├── gateway/                         # Layer: Gateway (AuthN/Z, quotas, schema validation)
│   │   ├── src/
│   │   │   ├── app/
│   │   │   ├── api/
│   │   │   ├── auth/
│   │   │   ├── policies/
│   │   │   └── schemas/                 # Pydantic v2 models (HTTP)
│   │   ├── tests/
│   │   ├── Dockerfile
│   │   └── pyproject.toml
│   │
│   ├── orchestrator/                    # DAG execution, idempotency, run lifecycle
│   │   ├── src/
│   │   │   ├── app/
│   │   │   ├── engine/                  # DAG runtime + step state machine
│   │   │   ├── idempotency/
│   │   │   ├── persistence/             # Postgres run index
│   │   │   ├── kafka/                   # produce/consume step/decision/audit topics
│   │   │   └── schemas/                 # Pydantic v2 (internal + API)
│   │   ├── tests/
│   │   ├── Dockerfile
│   │   └── pyproject.toml
│   │
│   ├── planner/                         # plan selection (cheap/full/degraded)
│   │   ├── src/
│   │   │   ├── app/
│   │   │   ├── strategies/
│   │   │   └── schemas/
│   │   ├── tests/
│   │   ├── Dockerfile
│   │   └── pyproject.toml
│   │
│   ├── policy-engine/                   # budgets, thresholds, allowlists
│   │   ├── src/
│   │   │   ├── app/
│   │   │   ├── rules/
│   │   │   ├── budgets/
│   │   │   ├── enforcement/
│   │   │   └── schemas/
│   │   ├── tests/
│   │   ├── Dockerfile
│   │   └── pyproject.toml
│   │
│   ├── context-projector/               # context plane assembly + context window enforcement
│   │   ├── src/
│   │   │   ├── app/
│   │   │   ├── planes/                  # event/run/policy/feature/model/observability
│   │   │   ├── assembly/
│   │   │   └── schemas/
│   │   ├── tests/
│   │   ├── Dockerfile
│   │   └── pyproject.toml
│   │
│   ├── arbitration/                     # signal aggregation + confidence + thresholds
│   │   ├── src/
│   │   │   ├── app/
│   │   │   ├── aggregators/
│   │   │   ├── scoring/
│   │   │   └── schemas/
│   │   ├── tests/
│   │   ├── Dockerfile
│   │   └── pyproject.toml
│   │
│   ├── verifier/                        # safety invariants, fail-closed, degrade mode
│   │   ├── src/
│   │   │   ├── app/
│   │   │   ├── invariants/
│   │   │   ├── degrade/
│   │   │   └── schemas/
│   │   ├── tests/
│   │   ├── Dockerfile
│   │   └── pyproject.toml
│   │
│   └── replay-controller/               # replay + drift detection reports -> S3
│       ├── src/
│       │   ├── app/
│       │   ├── replay/
│       │   ├── drift/
│       │   └── sinks/                   # S3 writer
│       ├── tests/
│       ├── Dockerfile
│       └── pyproject.toml

# =========================
# 4) Actor Fleet (Signals, not decisions)
# - Stateless, schema-in/out, cost-estimated, health-checked
# =========================
├── actors/
│   ├── rules-actor/
│   │   ├── src/
│   │   ├── tests/
│   │   ├── Dockerfile
│   │   └── pyproject.toml
│   ├── velocity-actor/
│   │   ├── src/
│   │   ├── tests/
│   │   ├── Dockerfile
│   │   └── pyproject.toml
│   ├── device-risk-actor/
│   │   ├── src/
│   │   ├── tests/
│   │   ├── Dockerfile
│   │   └── pyproject.toml
│   └── model-scorer-actor/              # optional (CPU-first vLLM)
│       ├── src/
│       ├── tests/
│       ├── Dockerfile
│       └── pyproject.toml

# =========================
# 5) AI / Inference (Optional, Controlled)
# - vLLM CPU mode + policy-gated
# - Langfuse only for model-scoring steps
# =========================
├── ai/
│   ├── inference/
│   │   ├── vllm-cpu/                    # deployment + configs
│   │   │   ├── model-manifests/
│   │   │   └── README.md
│   │   └── schemas/                     # strict IO schemas for model steps
│   └── langfuse/
│       ├── dashboards/
│       └── README.md

# =========================
# 6) Platform Runtime Dependencies (Kafka, Schema Registry, Postgres, Redis, Secrets)
# - Kubernetes manifests + Helm values
# =========================
├── platform/
│   ├── kafka/                           # Strimzi operator + Kafka cluster CRs
│   │   ├── strimzi-operator/
│   │   ├── clusters/
│   │   │   ├── dev/
│   │   │   ├── staging/
│   │   │   └── prod/
│   │   └── topics/                      # canonical topics + configs
│   │       ├── ecr-events.yaml
│   │       ├── ecr-steps.yaml
│   │       ├── ecr-decisions.yaml
│   │       ├── ecr-audit.yaml
│   │       └── ecr-dlq.yaml
│   │
│   ├── schema-registry/                 # Confluent Schema Registry deploy + compatibility
│   │   ├── base/
│   │   ├── overlays/
│   │   │   ├── dev/
│   │   │   ├── staging/
│   │   │   └── prod/
│   │   └── README.md
│   │
│   ├── postgres/                        # RDS is infra; this is app-level migrations/config
│   │   ├── migrations/
│   │   └── README.md
│   │
│   ├── redis/                           # ElastiCache is infra; this is app-level configs
│   │   └── README.md
│   │
│   ├── secrets/
│   │   ├── external-secrets-operator/   # ESO install manifests
│   │   └── external-secrets/            # ExternalSecret CRs per env/service
│   │       ├── dev/
│   │       ├── staging/
│   │       └── prod/
│   │
│   ├── ingress/
│   │   ├── alb/                         # ALB ingress controller configs/annotations
│   │   └── nlb/                         # NLB services (if needed for tcp)
│   │
│   └── policy/
│       ├── kyverno/                     # OR gatekeeper/opa
│       └── gatekeeper/

# =========================
# 7) GitOps (Argo CD mandatory) + Helm deployment units
# - App-of-Apps structure
# - Environments: dev/staging/prod
# =========================
├── deploy/
│   ├── argocd/
│   │   ├── bootstrap/                   # install argocd, projects, repos
│   │   ├── app-of-apps/
│   │   │   ├── dev.yaml
│   │   │   ├── staging.yaml
│   │   │   └── prod.yaml
│   │   └── applications/                # one app per component
│   │       ├── platform-kafka.yaml
│   │       ├── platform-schema-registry.yaml
│   │       ├── observability.yaml
│   │       ├── ecr-services.yaml
│   │       └── ecr-actors.yaml
│   │
│   ├── helm/                            # Helm is the deployment unit
│   │   ├── ecr-gateway/
│   │   ├── ecr-orchestrator/
│   │   ├── ecr-planner/
│   │   ├── ecr-policy-engine/
│   │   ├── ecr-context-projector/
│   │   ├── ecr-arbitration/
│   │   ├── ecr-verifier/
│   │   ├── ecr-replay-controller/
│   │   ├── actor-rules/
│   │   ├── actor-velocity/
│   │   ├── actor-device-risk/
│   │   ├── actor-model-scorer/
│   │   └── observability-stack/         # grafana/prom/tempo/loki + otel collector
│   │
│   └── env/
│       ├── dev/
│       │   ├── values/                  # values per chart
│       │   └── kustomize/               # optional overlays if you want it
│       ├── staging/
│       │   ├── values/
│       │   └── kustomize/
│       └── prod/
│           ├── values/
│           └── kustomize/

# =========================
# 8) Observability & Audit (Provisioned as Code)
# - OTel instrumentation in services
# - Prometheus/Alertmanager + Grafana dashboards
# - Loki logs, Tempo traces
# =========================
├── observability/
│   ├── otel/
│   │   ├── collector/
│   │   └── instrumentation/             # shared libs, config snippets
│   ├── prometheus/
│   │   ├── rules/
│   │   └── scrape-configs/
│   ├── alertmanager/
│   │   └── config/
│   ├── grafana/
│   │   ├── provisioning/
│   │   │   ├── datasources/
│   │   │   └── dashboards/
│   │   └── dashboards/
│   ├── loki/
│   │   └── config/
│   └── tempo/
│       └── config/

# =========================
# 9) Infra as Code (AWS)
# - Terraform builds: VPC, EKS, IAM/IRSA, RDS, ElastiCache, S3, ECR, Route53, ACM
# =========================
├── infra/
│   └── terraform/
│       ├── modules/
│       │   ├── vpc/
│       │   ├── eks/
│       │   ├── iam-irsa/
│       │   ├── rds-postgres/
│       │   ├── elasticache-redis/
│       │   ├── s3/
│       │   ├── ecr/
│       │   ├── route53/
│       │   └── acm/
│       └── environments/
│           ├── dev/
│           ├── staging/
│           └── prod/

# =========================
# 10) CI/CD (GitHub Actions) + Security Gates
# - Build/test, Buf checks, image build/push to ECR, Helm lint, SAST/dep scans
# =========================
├── .github/
│   ├── workflows/
│   │   ├── ci-services.yaml             # pytest, lint, type checks
│   │   ├── ci-actors.yaml
│   │   ├── contracts-buf.yaml           # lint + breaking change detection
│   │   ├── build-and-push-ecr.yaml      # docker build + push to Amazon ECR
│   │   ├── helm-validate.yaml
│   │   ├── terraform-validate.yaml
│   │   ├── security-codeql.yaml
│   │   └── dependency-scan.yaml
│   └── CODEOWNERS

# =========================
# 11) Testing (Unit/Integration/Load)
# - Integration spins Kafka/Postgres/Redis locally
# - k6 for load
# =========================
├── tests/
│   ├── integration/
│   │   ├── docker-compose.yaml          # local Kafka + SR + Postgres + Redis
│   │   ├── test_end_to_end.py
│   │   └── README.md
│   ├── load/
│   │   ├── k6/
│   │   │   ├── decide_flow.js
│   │   │   └── soak.js
│   │   └── README.md
│   └── contract/
│       └── schema-compat/               # CI checks around SR/buf policies

# =========================
# 12) Tooling / Scripts
# =========================
├── scripts/
│   ├── dev/
│   │   ├── kind-up.sh                   # optional local k8s
│   │   ├── local-stack-up.sh            # start compose integration deps
│   │   └── seed-topics.sh
│   ├── ops/
│   │   ├── replay.sh
│   │   ├── drift-report.sh
│   │   └── smoke-test.sh
│   └── release/
│       ├── promote-dev-to-staging.sh    # commit-based promotion helper
│       └── promote-staging-to-prod.sh

# =========================
# 13) Examples (Business problem packages)
# =========================
├── examples/
│   ├── fraud-decisioning/
│   │   ├── sample-events/
│   │   ├── sample-policies/
│   │   └── README.md
│   └── incident-triage/
│       ├── sample-events/
│       ├── sample-policies/
│       └── README.md

Folder-to-Stack Mapping (What lives where)
AWS + Terraform + EKS + VPC + RDS + ElastiCache + S3 + ECR + Route53 + ACM

infra/terraform/modules/* (everything AWS)

infra/terraform/environments/{dev,staging,prod} (vars/state per env)

GitOps (Argo CD App-of-Apps) + Helm Units + Env Promotion

deploy/argocd/app-of-apps/* (dev/staging/prod roots)

deploy/argocd/applications/* (apps per component)

deploy/helm/* (one chart per service/actor/obs)

deploy/env/*/values/* (values per env; promotion via Git commit only)

Kafka (Strimzi) + Topics + Schema Registry (Confluent)

platform/kafka/strimzi-operator/

platform/kafka/clusters/{dev,staging,prod}/

platform/kafka/topics/ (canonical topic CRs)

platform/schema-registry/ (deployment + compatibility enforcement)

Contracts: Protobuf persisted + Buf CI gates + Pydantic service contracts

protos/ecr/v1/* (canonical event contracts)

buf.yaml / buf.gen.yaml (enforcement + generation)

services/*/src/**/schemas/ (Pydantic v2 for HTTP/internal)

Runtime services: Gateway / Orchestrator / Planner / Policy Engine / Context Projector

services/gateway

services/orchestrator

services/planner

services/policy-engine

services/context-projector

Actor fleet (signals only)

actors/* (each actor independently buildable/deployable)

Optional AI inference + Langfuse for model steps only

ai/inference/vllm-cpu

ai/langfuse

Observability-as-memory: OTel + Prometheus + Grafana + Loki + Tempo

observability/* (all provisioned as code)

Deployed by deploy/helm/observability-stack

Security & governance: IRSA + External Secrets + Kyverno/Gatekeeper + Network Policies

IRSA lives in Terraform (infra/terraform/modules/iam-irsa)

ESO manifests + ExternalSecret CRs: platform/secrets/*

Admission policies: platform/policy/{kyverno,gatekeeper}

Testing & quality gates: pytest + integration + load + CodeQL + deps

tests/integration (compose)

tests/load/k6

.github/workflows/* (CI gates)

“Exact folders needed” (Minimum Set you must create first)

If you want the smallest repo that is still production-shaped, create these now:

docs/architecture
protos/ecr/v1/{events,decisions,common}
services/{gateway,orchestrator,policy-engine,context-projector}
actors/{rules-actor,velocity-actor,device-risk-actor}
platform/{kafka,schema-registry,secrets,policy,ingress}
deploy/{argocd/{bootstrap,app-of-apps,applications},helm,env/{dev,staging,prod}/values}
observability/{otel,prometheus,grafana,loki,tempo}
infra/terraform/{modules,environments/{dev,staging,prod}}
.github/workflows
tests/{integration,load/k6}
scripts/{dev,ops,release}
